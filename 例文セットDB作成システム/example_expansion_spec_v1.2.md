# Rephraseプロジェクト例文増殖設計仕様書（v1.2）

作成日: 2025-06-21  
作成者: ChatGPT（Rephraseプロジェクト参謀本部）  
用途: ChatGPT に例文増殖を依頼する際の標準仕様ガイド  

---

## 🎯 **目的**

例文増殖の際、各スロットの文法的・意味的整合性を保ち、ランダマイズ後も文が自然に成立することを保証する。  
ChatGPT が例文セットを生成・増殖する際、この仕様書を準拠ルールとして参照する。

---

## 📝 **スロット構造と属性仕様**

各例文は以下の標準スロットで構成する。各スロットには属性タグを必ず付与する。

| スロット | 内容例 | 必須属性 | 補足 |
|-----------|---------|----------|-------|
| M1 | That afternoon at the crucial point | time_place | 必ず具体的時刻・場所の情報 |
| S | the manager who had recently taken charge | number, gender, animacy | 主語の数（singular/plural）、性（male/female/neutral）、有生性 |
| Aux | had to make | - | 固定（ランダマイズ対象外） |
| V | make | - | 固定（ランダマイズ対象外） |
| O1 | the committee responsible for implementation | number, type | 数、集団/個人など |
| O2 | deliver the final proposal flawlessly | compatibleO1Type | 対応可能なO1のtype（group/individual/both） |
| M2 | even though he was under intense pressure | pronoun_owner | 所有者（主語に紐づく代名詞） |
| C1 | because he feared upsetting her | pronoun_owner | 同上 |
| C2 | - | - | 必要に応じて |
| M3 | so the outcome would reflect their full potential | result_owner | 所有者（O1等に紐づく結果） |

### **🔤 QuestionType（疑問語分類）属性**

| 属性値 | 説明 | 対象スロット | 例 |
|--------|-------|-------------|-----|
| wh-word | 疑問語（What, Where, When等） | M1, M2, M3, O2等 | What, Where, When, How |
| - | 疑問語以外（空白または未記載） | 全スロット | 通常の文要素 |

**🚨 重要な制約**: ランダマイズ時、`QuestionType: wh-word`の要素は文中に1つまでしか選択されません。これにより「What」と「Where」が同時に現れる等の文法的に不自然な組み合わせを防止します。

---

## 🧩 **ランダマイズ設計ルール**

1️⃣ **ランダマイズ対象スロット**
- M1, S, O1, O2, M2, C1, M3, C2
- Aux, V は固定

2️⃣ **組み合わせ整合ルール**
- O1 の type と O2 の compatibleO1Type が一致する必要がある。
- S の number / gender に基づいて M2, C1 の代名詞（he/his/they/their 等）を補正。
- O1 の number/type に基づいて M3 の所有代名詞を補正。
- **🔤 QuestionType制約**: `QuestionType: wh-word`の要素は文中に1つまでしか選択されない（疑問語重複防止）。

3️⃣ **疑問語競合防止処理**
- ランダマイズ前に全スロット候補から `QuestionType: wh-word` を含む要素を事前抽出。
- 疑問語候補が存在する場合、その中から1つのみを選択し、他の疑問語要素を除外。
- 疑問語以外の通常要素は除外対象から外して通常通りランダマイズ。
- これにより「What do you think Where is it?」等の文法的に破綻した文の生成を防止。

3️⃣ **補正後処理**
- ランダマイズ後に各スロット属性を確認し、代名詞・所有格を動的補正する。
- 疑問語競合チェック: 選択されたスロット群に `QuestionType: wh-word` が2つ以上含まれる場合は再選択。
- 補正例:
  - S: singular male → M2/C1: he / his
  - S: singular female → M2/C1: she / her
  - S: plural → M2/C1: they / their
  - O1: group → M3: their
  - O1: singular neutral → M3: its

4️⃣ **性（gender）補正ルール**
- 主語（S）は必ず gender 属性を持ち、ランダマイズ後の M2, C1 の代名詞・所有格は S の gender 属性に基づいて補正すること。
- 代名詞補正が困難または曖昧な場合、代名詞の代わりに S のフル表現を使用して文の一貫性を保つことも許容する。

---

## 📌 **ユーザー例示・文法要点の尊重**

💡 **原則**
- ユーザーが指示する文法要点（例：不定詞の名詞的用法、強制構文、使役構文など）を必ず守り、その文法要点に基づく文のみを増殖対象とする。
- ユーザーが例示した文のスロット構造・使用パターンを可能な限り保持し、同様のスロット種別・数・順序を用いる。

💡 **具体例**
- 例示文が M1, S, Aux, V, O1, O2, M2, M3 を含んでいる場合、増殖文も同スロット構造を基本とする。
- スロット省略や追加は、ユーザーの特別な指示がある場合のみ行う。

---

## 🌱 **例文増殖プロセス**

1️⃣ ユーザーの例示文・文法要点を確認。  
2️⃣ 母集団例文の各スロットを属性付きで定義（QuestionType属性を含む）。  
3️⃣ ランダマイズ前に疑問語競合チェック（`QuestionType: wh-word`の重複防止）。  
4️⃣ ランダマイズでスロットを抽出し、整合ルールを確認。  
5️⃣ 整合しない組み合わせは破棄、または属性適合する組み合わせを再抽出。  
6️⃣ 組み合わせ確定後、代名詞・所有格を補正。  
7️⃣ 最終出力。
⓼表示順序は絶対順序で（M1が1,Sが2,Auxが3,Vが4…のように要素ごとの固定順序にする。例えばSVしか無い文でもS-2, V-4とする。こうしないとランダマイズがうまくいかない）

---

## ⚠ **留意点**

- スロット属性の記載漏れがないこと（特にQuestionType属性）。
- QuestionType属性が未記載の疑問語（What, Where等）は疑問語重複防止システムの対象外となるため注意。
- 属性未記載のスロットはランダマイズ対象外。
- 意味破綻のリスクがある O1-O2, S-M2-M3 の組み合わせはペアまたは属性整合ルールで管理。
- 疑問語競合防止により「What + Where」等の組み合わせは自動的に排除される。
- ユーザーの例示文・文法要点を必ず確認し、それに基づく文法的な一貫性を維持。

---

## 💾 **ChatGPTに依頼する際の指示例**

```
この仕様書に基づき、構文5001用の例文増殖をお願いします。
例示文のスロット構造・文法要点を保持してください。
属性整合の取れた例文を5セット生成してください。
出力形式：JSON または表形式
```

---

## 🛠 **拡張予定（次バージョンで追加）**
- スロット属性リストの詳細例（Excel/JSON）
- 属性間整合マトリクス
- 補正アルゴリズムの疑似コード

---

## 🔑 **保存用備考**
この仕様書を ChatGPT にアップロードし、例文増殖依頼時の基準ファイルとする。
ファイル名推奨：`example_expansion_spec_v1.2.md`

---

## 🤖 **ML Model 活用方針（2025年7月11日更新）**

### 📊 **現状分析結果**
- **スロット分解**: 複雑な文脈依存性とルール例外が多く、ML modelは適さない
- **現在のアプローチ**: 手動ルールベース（slottext.json）が適切で効果的
- **既存ML実装**: ml_model_from_excel.py は構造予測用で、実際には使用されていない

### 🎯 **段階的活用戦略**
```
フェーズ1（現在）: 手動ルール充実
├── slottext.json の体系化・例外ケース対応
├── 階層化ルール導入
└── 例文セット作成継続

フェーズ2（データ蓄積中期）: 
├── 例文データ蓄積（目標：1000-5000例文）
├── パターン分析・ルール効果測定
└── 自動パターン発見の準備

フェーズ3（ML活用期）:
├── ml_model_from_excel.py をslottext.json作成用に改造
├── 蓄積データでの学習（補助テキスト生成特化）
└── 既存ルールとML予測の融合システム
```

### 💡 **将来的なML活用方針**
- **目的**: スロット分解ではなく、補助テキスト生成の自動化
- **学習データ**: 蓄積された例文セットと対応する補助テキスト
- **手法**: 文脈を考慮した分類・生成モデル
- **統合**: 既存slottext.jsonルールとML予測の併用
