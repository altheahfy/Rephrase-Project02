
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Rephrase Structured UI</title>
  <link href="style.css" rel="stylesheet"/>
  <script src="js/subslot_toggle.js"></script>
  <script src="js/log_o1_identifiers.js" type="module"></script>
</head>
<body>
  <section></section>
  <h1>ğŸ§ª Subslot Structured Test with Upper Slots</h1>
  <section>
    <button id="randomize-all">å…¨ä½“ãƒ©ãƒ³ãƒ€ãƒã‚¤ã‚º</button>
    <input type="file" id="jsonFileInput" accept=".json">
    <button id="loadJsonButton">ãƒ­ãƒ¼ãƒ‰</button>
    <button id="log-o1-button">O1è­˜åˆ¥ç•ªå·ç¢ºèª</button>
    <!-- å…ƒã®ã‚¹ãƒ­ãƒƒãƒˆæ§‹é€ ã¯çœç•¥ï¼ˆæ—¢å­˜å†…å®¹ã‚’ãã®ã¾ã¾åˆ©ç”¨ï¼‰ -->
  </section>
  <script src="./js/renderer_core.js" type="module"></script>
  <script src="js/structure_builder.js" type="module"></script>
</body>
</html>

<script type="module">
import { randomizeAll } from './js/randomizer_all.js';
import { buildStructure } from './js/structure_builder.js';
import { logO1Identifiers } from './js/log_o1_identifiers.js';

let loadedJsonData = null;

document.getElementById("loadJsonButton").addEventListener("click", () => {
  const fileInput = document.getElementById("jsonFileInput");
  if (fileInput.files.length === 0) {
    alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„");
    return;
  }
  const file = fileInput.files[0];
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      loadedJsonData = JSON.parse(e.target.result);
      window.loadedJsonData = loadedJsonData;
      console.log("ğŸŸ¢ window.loadedJsonData ã‚»ãƒƒãƒˆå®Œäº†:", window.loadedJsonData);
      const data = randomizeAll(loadedJsonData);
      console.log("ãƒ©ãƒ³ãƒ€ãƒã‚¤ã‚ºçµæœè©³ç´°:", JSON.stringify(data, null, 2));
      validateSlots(data);
      buildStructure(data);
    } catch (err) {
      console.error("âŒ JSON ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯å‡¦ç†ä¾‹å¤–", err);
      alert("ç„¡åŠ¹ãª JSON ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™");
    }
  };
  reader.readAsText(file);
});

document.getElementById("randomize-all").addEventListener("click", () => {
  if (!loadedJsonData || !Array.isArray(loadedJsonData)) {
    alert("å…ˆã«æ­£ã—ã„JSONãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„");
    console.error("âŒ å…¨ä½“ãƒ©ãƒ³ãƒ€ãƒã‚¤ã‚ºï¼šãƒ­ãƒ¼ãƒ‰æ¸ˆãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£ã¾ãŸã¯æœªãƒ­ãƒ¼ãƒ‰");
    return;
  }
  const data = randomizeAll(loadedJsonData);
  console.log("ãƒ©ãƒ³ãƒ€ãƒã‚¤ã‚ºçµæœè©³ç´°ï¼ˆå…¨ä½“ãƒœã‚¿ãƒ³ï¼‰:", JSON.stringify(data, null, 2));
  validateSlots(data);
  buildStructure(data);
});

document.getElementById("log-o1-button").addEventListener("click", () => {
  if (!loadedJsonData) {
    alert("å…ˆã« JSON ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„");
    return;
  }
  logO1Identifiers(loadedJsonData);
});

function validateSlots(data) {
  const requiredSlots = ["M1", "S", "V"];
  const presentSlots = data.map(d => d.Slot);
  requiredSlots.forEach(slot => {
    if (!presentSlots.includes(slot)) {
      console.warn(`âš  å¿…é ˆã‚¹ãƒ­ãƒƒãƒˆ ${slot} ãŒãƒ©ãƒ³ãƒ€ãƒã‚¤ã‚ºçµæœã«å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“`);
    }
  });
}
</script>
