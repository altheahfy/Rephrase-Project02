
# Rephraseプロジェクト ランダマイズアルゴリズム・DB設計仕様書（改訂版）

## 目的
Rephraseプロジェクトにおけるランダマイズ処理の仕様、DB設計との関係、全体ランダマイズ・個別ランダマイズの詳細を記述し、実装・引き継ぎ時の基準文書とする。

---

## ランダマイズ母集団の設計
- 母集団キーは **構文ID + V_group_key (Aux＋V セット)**。
- V_group_key は助動詞＋動詞の組を一意に示すもの。
- 各スロットデータは V_group_key によってどの母集団に属するかが決まる。

---

## 全体ランダマイズの流れ
- **randomizer_all が初回の V_group_key 母集団選択とスロット群決定を担当する。**
- 選ばれた V_group_key に属するスロット群からスロットをランダムに選択。

---

## 個別ランダマイズの流れ
- 個別ランダマイズは randomizer_individual.js が担当。
- 現在表示中の V_group_key のスロット群内で該当スロット種をランダム選択・置換。

---

## DB構造との関係
- DB (slot_order_data.json) は V_group_key 単位でスロット群を構造化。
- ExampleID は不要。母集団キーとして Aux＋V セットで管理。

---

## 注意事項
- structure_builder.js は選択済のスロット群を受け取り描画するのみとする。
- randomizer_all が選択責任を持ち、構造モジュールは描画責任に集中。


---

## V_group_key 母集団の識別番号ランダマイズ仕様（追加）

- V_group_key 母集団内のスロットは、例文IDを手掛かりに親スロットとサブスロットをペアとして整理する。
- 各スロットは、例文IDを超えた混合母集団形成のため「識別番号」を付与し、例：M1-1, M1-2 のように管理する。
- ランダマイズは識別番号単位で行われ、選出された識別番号に対応する親スロットとそのサブスロットを一括で出力対象とする。
- ExampleID は識別番号付与後のランダマイズ処理では使用せず、スロット種間の自然な混合を保証する。
