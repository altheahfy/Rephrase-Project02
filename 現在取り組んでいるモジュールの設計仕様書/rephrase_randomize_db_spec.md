
# Rephraseプロジェクト ランダマイズアルゴリズム・DB設計仕様書（草案）

## 目的
Rephraseプロジェクトにおけるランダマイズ処理の仕様、DB設計との関係、全体ランダマイズ・個別ランダマイズの詳細を記述し、実装・引き継ぎ時の基準文書とする。

---

## ランダマイズ母集団の設計
- 母集団キーは **構文ID + V_group_key (Aux＋V セット)**。
- V_group_key は助動詞＋動詞の組を一意に示すもの（例：must_have_figured_out, had_known）。
- 各スロットデータは V_group_key によってどの母集団に属するかが決まる。

---

## 全体ランダマイズの流れ
- 構文ID + V_group_key の母集団リストからランダムに1組の Aux＋V セットを選択。
- 選ばれた V_group_key に属するスロット群から、M1, S, O1 などのスロットをランダムに選択。

---

## 個別ランダマイズの流れ
- 現在表示中の V_group_key のスロット群の中で該当スロット種（例：M1, S）の候補リストを作成。
- そのリストからランダムに1つを選択し、該当スロットを置き換え。

---

## DB構造との関係
- DB (slot_order_data.json) は V_group_key 単位でスロット群を構造化。
- ExampleID は不要。例文単位でスロット群をまとめる必要はなく、Aux＋V セットを母集団キーとしてすべて管理。

---

## 注意事項
- ランダマイズは母集団キーごとに整合性を保証。
- 全体・個別ともに仕様上の母集団構造を前提にするため、仕様逸脱する組み合わせは選ばれない。
- 必要に応じて DB は母集団キー構造で正規化されている必要がある。
