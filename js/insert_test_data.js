// insert_test_data.js ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸå‹•çš„è¨˜è¼‰ã‚¨ãƒªã‚¢ã‹ã‚‰é™çš„DOMåŒæœŸç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

function extractDataFromDynamicArea() {
  const dynamicArea = document.getElementById("dynamic-slot-area");
  if (!dynamicArea) {
    console.warn("âš  dynamic-slot-area ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
    return [];
  }

  const slotElements = dynamicArea.querySelectorAll(".slot, .subslot");
  const data = [];

  slotElements.forEach(el => {
    const slotId = el.id || el.getAttribute("id");
    if (!slotId) return;

    const phraseEl = el.querySelector(".slot-phrase, .subslot-element");
    const textEl = el.querySelector(".slot-text, .subslot-text");

    const phraseText = phraseEl ? phraseEl.textContent : "";
    const slotText = textEl ? textEl.textContent : "";

    data.push({
      Slot: slotId,
      SlotPhrase: phraseText,
      SlotText: slotText
    });
  });

  return data;
}


function normalizeSlotId(slotId) {
  return slotId.replace(/-sub-sub/g, '-sub');
}


function syncDynamicToStatic() {
  // ğŸ‘‡ äº‹å‰ã«é™çš„ã‚¹ãƒ­ãƒƒãƒˆã®ä¸­èº«ã‚’ã‚¯ãƒªã‚¢
  const allPhrases = document.querySelectorAll(".slot-phrase");
  const allTexts = document.querySelectorAll(".slot-text");
  allPhrases.forEach(el => el.textContent = "");
  allTexts.forEach(el => el.textContent = "");

  const data = extractDataFromDynamicArea();
  if (data.length === 0) {
    console.warn("âš  å‹•çš„ã‚¨ãƒªã‚¢ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã§ãã¾ã›ã‚“ã§ã—ãŸ");
    return;
  }

  
  data.forEach(item => {
    if (item.SubslotID === "" && item.PhraseType === "word") {
      // ä¸Šä½ã‚¹ãƒ­ãƒƒãƒˆã¸ã®æ›¸ãè¾¼ã¿
      
    console.log("æ¤œç´¢ID(normalized):", normalizeSlotId(item.Slot));
    const container = document.getElementById(normalizeSlotId(item.Slot));
      if (container) {
      console.log("container found for ID:", container.id);
        const phraseDiv = container.querySelector(".slot-phrase");
      console.log("phraseDiv:", phraseDiv);
        const textDiv = container.querySelector(".slot-text");
      console.log("textDiv:", textDiv);
        if (phraseDiv) {
          phraseDiv.textContent = item.SlotPhrase || "";
          console.log(`âœ… phraseæ›¸ãè¾¼ã¿æˆåŠŸ: ${item.Slot} (parent)`);
        }
        if (textDiv) {
          textDiv.textContent = item.SlotText || "";
          console.log(`âœ… textæ›¸ãè¾¼ã¿æˆåŠŸ: ${item.Slot} (parent)`);
        }
      }
      return;
    }
    // å…ƒã®ã‚µãƒ–ã‚¹ãƒ­ãƒƒãƒˆæ›¸ãè¾¼ã¿å‡¦ç†ï¼ˆä»¥ä¸‹ã¯æ—¢å­˜å‡¦ç†ã‚’ãã®ã¾ã¾æ®‹ã™ï¼‰
    console.log("ã‚µãƒ–ã‚¹ãƒ­ãƒƒãƒˆæ¤œç´¢ID(normalized):", normalizeSlotId(item.Slot));
    const slotElement = document.getElementById(normalizeSlotId(item.Slot));
    if (!slotElement) {
      console.log("ã‚µãƒ–ã‚¹ãƒ­ãƒƒãƒˆè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:", normalizeSlotId(item.Slot));
      console.warn(`âš  ã‚¹ãƒ­ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${item.Slot}`);
      return;
    }
    const phraseElement = slotElement.querySelector(".slot-phrase");
    console.log("ã‚µãƒ–ã‚¹ãƒ­ãƒƒãƒˆ phraseElement:", phraseElement);
    const slotTextElement = slotElement.querySelector(".slot-text");
    console.log("ã‚µãƒ–ã‚¹ãƒ­ãƒƒãƒˆ textElement:", slotTextElement);

    if (phraseElement) {
      phraseElement.textContent = item.SlotPhrase;
      console.log(`âœ… phraseæ›¸ãè¾¼ã¿æˆåŠŸ: ${item.Slot}`);
    }
    if (slotTextElement) {
      slotTextElement.textContent = item.SlotText;
      console.log(`âœ… textæ›¸ãè¾¼ã¿æˆåŠŸ: ${item.Slot}`);
    }
  });

}

// ä¾‹ï¼šãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰å¾Œã‚„JSONãƒ­ãƒ¼ãƒ‰å¾Œã«å‘¼ã¶
window.onload = function() {
  syncDynamicToStatic();
};
