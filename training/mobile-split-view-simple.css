/* =================================================================== */
/* 📱 モバイル上下2分割スワイプシステム - PC版完全保持版               */
/* =================================================================== */

/* 🎨 CSS変数定義（リファクタリング第1段階） */
:root {
  --mobile-width: calc(100vw - 4px);
  --mobile-margin: 2px;
  --mobile-border-radius: 4px;
}

/* 🚨 重要：設計要件定義（絶対遵守） */
/* ①スマホ画面を上下に分割（上部パネル・ボタンを考慮した分割比率）      */
/* ②各エリアは「スワイプエリア」：左右スワイプ + 画面全体ピンチ拡大縮小  */
/* ③PC版の上位スロット・サブスロットをそのまま表示                    */
/* ④デザイン・機能（ランダマイズ・イラスト表示・順序制御・分離疑問詞等） */
/*   は一切変更禁止。位置・大きさ調整のみ許可                        */
/* ⑤PC版の全機能を完全保持：自動幅調整・高さ調整・レイアウト等         */

/* ✅ PC版のスタイルを完全に保持し、モバイルでは最小限の調整のみ      */

/* ① タッチ操作の改善：画面全体操作可能 */
.mobile-device body {
  touch-action: manipulation; /* 画面全体でピンチ拡大縮小可能 */
}

/* ========================================= */
/* 🚀 上部エリア超圧縮（スロット領域最大化） */
/* ========================================= */

/* フロートメニュー圧縮 - gap完全削除、padding最小化 */
.mobile-device #navigation-float-menu {
  top: 2px !important;
  left: 2px !important;
  padding: 2px 3px !important; /* 4px 6px → 2px 3px */
  gap: 0px !important; /* 6px → 0px 完全削除 */
  height: 22px !important; /* 28px → 22px */
  font-size: 10px !important;
  border-radius: 2px !important;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1) !important;
}

/* フロートメニュー内要素間隔削除 */
.mobile-device #navigation-float-menu a {
  font-size: 10px !important; /* 14px → 10px */
  padding: 1px 2px !important;
  margin: 0 !important;
}

.mobile-device #navigation-float-menu span {
  font-size: 8px !important; /* 12px → 8px */
  margin: 0 1px !important;
}

.mobile-device #navigation-float-menu select {
  width: 60px !important; /* 120px → 60px */
  font-size: 8px !important; /* 12px → 8px */
  height: 16px !important; /* 20px → 16px */
  padding: 0px 1px !important;
}

.mobile-device #navigation-float-menu button {
  font-size: 8px !important; /* 11px → 8px */
  padding: 1px 3px !important; /* 2px 6px → 1px 3px */
  height: 16px !important; /* 20px → 16px */
}

.mobile-device #navigation-float-menu input[type="range"] {
  width: 40px !important; /* 80px → 40px */
  height: 14px !important; /* 18px → 14px */
}

.mobile-device #navigation-float-menu label {
  font-size: 8px !important; /* 12px → 8px */
}

/* タイトル帯の超圧縮 */
.mobile-device div[style*="background: rgba(255,255,255,0.95)"] {
  padding: 2px 5px !important; /* 15px → 2px 5px */
  margin-bottom: 2px !important; /* 15px → 2px */
  margin-top: 26px !important; /* 50px → 26px フロートメニュー直下 */
  border-radius: 3px !important;
  box-shadow: none !important; /* シャドウ削除 */
}

.mobile-device h1 {
  font-size: 12px !important; /* 28px → 12px */
  margin: 0 !important;
  font-weight: 600 !important;
}

/* ② タイトル帯の正確な修正 */
.mobile-device h2 {
  font-size: 10px !important;
  margin: 1px 0 !important;
}

.mobile-device button {
  font-size: 10px !important;
  padding: 3px 6px !important;
  margin: 1px !important;
  min-height: 20px !important;
}

/* ========================================= */
/* 🎛️ 制御パネル・ボタン類の圧縮            */
/* ========================================= */

/* 制御パネル表示ボタンの圧縮 */
.mobile-device div[style*="justify-content: flex-start"][style*="margin-bottom: 15px"] {
  margin-bottom: 2px !important; /* 15px → 2px */
}

.mobile-device #toggle-control-panels {
  padding: 3px 8px !important;
  font-size: 10px !important;
  border-radius: 3px !important;
}

/* 🎯 上位スロット制御パネルをサブスロットと完全同一デザインに（PC版・スマホ版共通） */
#visibility-control-panel-inline > div[style*="display: flex"] {
  display: flex !important;
  gap: 8px !important;
  align-items: center !important;
  font-size: 12px !important;
  flex-wrap: wrap !important;
}

#visibility-control-panel-inline .slot-control-group {
  padding: 4px !important;
  border: 1px solid #f0f0f0 !important;
  border-radius: 3px !important;
  background: rgba(255, 255, 255, 0.7) !important;
}

#visibility-control-panel-inline .slot-control-group div:first-child {
  font-weight: bold !important;
  font-size: 11px !important;
  margin-bottom: 2px !important;
  color: #444 !important;
  text-align: center !important;
}

#visibility-control-panel-inline .slot-control-group div:last-child {
  display: flex !important;
  flex-direction: column !important;
  gap: 2px !important;
  font-size: 10px !important;
}

/* 🎯 サブスロットの実際のボタンデザインを完全コピペ */
#visibility-control-panel-inline .slot-control-group label {
  display: flex !important;
  align-items: center !important;
  gap: 3px !important;
  padding: 3px 6px !important;
  border: 1px solid #ddd !important;
  border-radius: 3px !important;
  cursor: pointer !important;
  font-size: 10px !important;
  transition: all 0.2s !important;
  /* サブスロットの薄いグリーン背景をデフォルトに */
  background-color: #e8f5e8 !important;
  border-color: #4CAF50 !important;
  color: #2e7d32 !important;
}

/* チェックボックスを完全に非表示（サブスロットにはチェックボックスがない） */
#visibility-control-panel-inline .slot-control-group input[type="checkbox"] {
  display: none !important;
}

/* チェック状態（選択状態）でのサブスロットスタイル維持 */
#visibility-control-panel-inline .slot-control-group label:has(input:checked) {
  background-color: #e8f5e8 !important;
  border-color: #4CAF50 !important;
  color: #2e7d32 !important;
}

/* 非チェック状態（非選択状態）はサブスロットの非表示スタイル */
#visibility-control-panel-inline .slot-control-group label:has(input:not(:checked)) {
  background-color: #ffebee !important;
  border-color: #f44336 !important;
  color: #c62828 !important;
  opacity: 0.8 !important;
}

/* 例文シャッフル等のボタン群圧縮 */
.mobile-device #randomize-all,
.mobile-device button[style*="background"] {
  padding: 3px 6px !important;
  font-size: 9px !important;
  margin: 1px 2px !important;
  min-height: 18px !important;
  border-radius: 2px !important;
}

/* 分離疑問詞エリアの圧縮 */
.mobile-device #display-top-question-word {
  margin: 1px 0 !important;
  padding: 2px !important;
}

/* 音声制御系ボタンの圧縮 */
.mobile-device .voice-controls button {
  padding: 2px 4px !important;
  font-size: 8px !important;
  min-height: 16px !important;
  margin: 1px !important;
}

/* ========================================= */
/* 📐 全体余白の最小化（スロット領域最大化） */
/* ========================================= */

/* body全体の余白削除 + 横幅最大化 */
.mobile-device body {
  margin: 0 !important;
  padding: 0 !important;
  width: 100vw !important; /* 画面幅いっぱい */
  overflow-x: hidden !important; /* 横スクロール防止 */
}

/* セクション要素の余白削除 + 横幅最大化 */
.mobile-device section {
  margin: 0 !important;
  padding: 0 !important; /* 2px → 0px */
  width: 100% !important;
}

/* main-content の余白削除 + 横幅最大化 */
.mobile-device #main-content {
  padding: 0 !important;
  margin: 0 !important;
  width: 100% !important;
}

/* div要素全般の余白圧縮 - 隙間最小化 */
/* 🚨 コメントアウト：動的記載エリア問題の原因
.mobile-device div {
  margin: 0 !important;
}
*/

/* 📐 スロット間隙間の完全最小化 */
/* 🚨 コメントアウト：PC版機能破壊の原因
.mobile-device * {
  box-sizing: border-box !important;
}
*/

/* フレックスコンテナやグリッドのgap削除 */
/* 🚨 コメントアウト：レイアウト崩壊の原因
.mobile-device .slot-container,
.mobile-device [style*="display: flex"],
.mobile-device [style*="display: grid"] {
  gap: 0 !important;
  column-gap: 0 !important;
  row-gap: 0 !important;
}
*/

/* 📱 モバイル用：PC版完全保持 + スワイプ対応のみ追加 */

/* 🎯 PC版完全保持 + サイズ最適化（実際のコンテンツにフィット） */
.mobile-device .slot-wrapper:not([id$="-sub"]) {
  /* PC版のスタイルに一切介入しない */
  touch-action: pan-x pan-y !important; /* タッチ操作のみ追加 */
  
  /* 🎯 上位スロットのサイズを画面内収納に調整 */
  height: 38vh !important; /* 36vh → 38vh: 縮小幅を調整（元40vhから5%縮小） */
  
  /* 🎯 横幅をスマホ画面幅いっぱいに拡張 */
  width: var(--mobile-width) !important; /* 画面幅いっぱい */
  min-width: var(--mobile-width) !important; /* 最小幅固定 */
  max-width: var(--mobile-width) !important; /* 最大幅固定 */
  
  /* スワイプ対応追加：横スワイプのみ有効、縦スクロール無効 */
  overflow-x: auto !important;
  overflow-y: hidden !important;
  
  /* 🔧 無駄な空白を削除 - コンテンツにフィット */
  display: flex !important;
  align-items: flex-start !important; /* center → flex-start: コンテンツを上側に配置 */
  justify-content: flex-start !important; /* 横方向左寄せ */
  padding-top: 8px !important; /* 0px → 8px: 上位スロットを少し下に移動 */
  
  /* 視覚的境界線 */
  border: 2px solid #007bff !important; /* 青色で上位スロット識別 */
  border-radius: 4px !important;
  background: rgba(240, 248, 255, 0.9) !important;
  margin: 2px !important;
}

.mobile-device #subslot-display-area,
.mobile-device .slot-wrapper[id$="-sub"] {
  width: var(--mobile-width) !important; /* サブスロットは従来通り */
  max-width: var(--mobile-width) !important;
  min-width: var(--mobile-width) !important;
}

/* ========================================= */
/* 🎯 修正：サブスロット選択表示システム      */
/* ========================================= */

/* 🎯 上位スロット内部コンテンツは標準サイズで表示 */
.mobile-device .slot-wrapper:not([id$="-sub"]) > * {
  /* 上位スロットは重要なので自然なサイズで表示 */
  margin: 2px !important; /* 適度な余白 */
  zoom: 0.95 !important; /* 0.9 → 0.95: カメラズームアウト縮小幅を調整（5%縮小） */
}

/* 🟢 サブスロット表示エリア：画面内完全収納サイズに調整 */
.mobile-device #subslot-display-area {
  height: 12vh !important; /* 14vh → 12vh: サブスロットエリアをさらに縮小、上位により多くの領域を確保 */
  width: var(--mobile-width) !important; /* 横幅をほぼ画面幅いっぱいに（余白2px×2） */
  max-width: var(--mobile-width) !important; /* 最大幅も同様に設定 */
  min-width: var(--mobile-width) !important; /* 最小幅も固定（複数画像時の変動防止） */
  overflow-x: auto !important;
  overflow-y: hidden !important; /* 縦スクロール無効化：見切れ防止 */
  touch-action: pan-x pan-y !important;
  margin: 0px 1px !important; /* 1px 2px → 0px 1px: 余白最小化で画面活用 */
  border: 1px solid #28a745 !important; /* 2px → 1px: ボーダー縮小 */
  border-radius: 2px !important; /* 4px → 2px: 角丸縮小 */
  background: rgba(248, 255, 248, 0.9) !important; /* 透明度上げて軽量化 */
  display: block !important;
  position: relative !important;
  
  /* 🎯 エリア全体のコンテンツ縮小を強化 - 画面内完全収納 */
  transform: scale(0.85) !important; /* 0.9 → 0.85: さらに縮小して確実に画面内収納 */
  transform-origin: top left !important; /* 左上基準で縮小 */
}

/* 🚫 全サブスロットをデフォルトで非表示（PC版と同じ動作） */
.mobile-device .slot-wrapper[id$="-sub"] {
  display: none !important; /* デフォルトは非表示 */
}

/* ✅ 選択されたサブスロットのみ表示 */
.mobile-device .slot-wrapper[id$="-sub"].active-subslot {
  display: block !important; /* 選択時のみ表示 */
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100% !important;
  height: 100% !important;
  overflow-x: auto !important;
  overflow-y: hidden !important; /* 縦スクロール無効化：見切れ防止 */
  border: none !important;
  background: transparent !important;
  /* スワイプエリアのサイズは維持 */
}

/* 🎯 サブスロット内部コンテンツは大幅縮小で画面内収納 */
.mobile-device .slot-wrapper[id$="-sub"].active-subslot > * {
  transform: scale(0.7) !important; /* 0.8 → 0.7: より小さくして画面内確実収納 */
  transform-origin: top left !important;
}

/* 🎯 サブスロット表示エリア内の全コンテンツ強制縮小（動的生成対応） */
.mobile-device #subslot-display-area * {
  font-size: 85% !important; /* フォントサイズも縮小 */
}

/* 🎯 サブスロット表示エリア内のボタン・画像も縮小 */
.mobile-device #subslot-display-area button {
  transform: scale(0.8) !important; /* ボタンも80%に縮小 */
}

.mobile-device #subslot-display-area img {
  max-height: 80px !important; /* 画像高さ制限 */
}

/* 🔧 スロット内コンテンツの基本調整のみ - 隙間最小化 */
.mobile-device .slot-wrapper .slot-container {
  padding: 2px !important; /* 4px → 2px */
  margin: -3px 0 1px 0 !important; /* 1px 0 → -3px 0 1px 0: 上位スロットを適切な位置に調整 */
  
  /* 🎯 PC版の自動幅調整を強制的に復元 */
  width: auto !important;
  max-width: none !important;
  flex: 0 0 auto !important;
  min-width: 160px !important; /* PC版と同じ最小幅 */
}

.mobile-device .slot-wrapper .slot {
  padding: 3px !important; /* 5px → 3px */
  margin: 1px !important; /* 3px → 1px */
}

/* ========================================= */
/* 🔧 ボタン表示の確実な保証                 */
/* ========================================= */

/* 🚨 PC版レイアウト構造は絶対に変更しない！ */
/* 横一列レイアウト（ID、イラスト、日本語、英語、詳細、ランダマイズ）を保持 */

/* ボタンのタッチ操作改善 */
.mobile-device button {
  touch-action: manipulation !important; /* ボタンタップを優先 */
  pointer-events: auto !important; /* ボタンクリックを確実に有効化 */
  z-index: 1000 !important; /* 最前面に表示 */
}

/* 個別ランダマイズボタンの表示保証 */
.mobile-device button[onclick*="Individual"],
.mobile-device .randomize-button {
  background: #ff9800 !important;
  color: white !important;
  font-weight: bold !important;
  min-width: 15px !important;
  visibility: visible !important;
  display: inline-block !important;
  touch-action: manipulation !important; /* タップ操作優先 */
  pointer-events: auto !important;
  z-index: 1001 !important; /* さらに前面に */
}

/* 🎯 モバイルでの個別ランダマイズボタン強化表示 */
.mobile-device button[onclick*="randomizeIndividual"] {
  background: #ff6600 !important; /* より目立つオレンジ */
  color: white !important;
  font-size: 8px !important;
  padding: 2px 4px !important;
  margin: 1px !important;
  border: 1px solid #ff4400 !important;
  border-radius: 2px !important;
  min-width: 12px !important;
  min-height: 12px !important;
  font-weight: bold !important;
  display: inline-block !important;
  visibility: visible !important;
  opacity: 1 !important;
  position: relative !important;
  z-index: 1002 !important;
  pointer-events: auto !important;
  touch-action: manipulation !important;
}

/* 🔧 スロット内のすべてのボタン表示強化 */
.mobile-device .slot-wrapper button,
.mobile-device .slot button {
  display: inline-block !important;
  visibility: visible !important;
  opacity: 1 !important;
  pointer-events: auto !important;
  z-index: 100 !important;
  position: relative !important;
}

/* 🎯 "R"ボタン（ランダマイズ）の特別強化 */
.mobile-device button[style*="background-color: orange"],
.mobile-device button[style*="background: orange"] {
  background: #ff6600 !important;
  color: white !important;
  font-size: 8px !important;
  padding: 1px 3px !important;
  margin: 0px 1px !important;
  min-width: 10px !important;
  min-height: 10px !important;
  border: 1px solid #ff4400 !important;
  border-radius: 1px !important;
  font-weight: bold !important;
  display: inline-block !important;
  visibility: visible !important;
  opacity: 1 !important;
  z-index: 1003 !important;
}

/* ========================================= */
/* 🎯 サブスロット無駄スペース削除（段階的）  */
/* ========================================= */

/* 🎯 PC版で共通対応済み：無駄な5・6行目削除は style.css で実装済み */

/* 🎯 モバイル専用：スワイプ機能のみ追加（PC版スタイル完全保持） */

/* ========================================= */
/* 📱 横向き専用：上部スワイプエリア拡大     */
/* ========================================= */

/* 横向き（ランドスケープ）モードのみ：上部スワイプエリア固定 + 真のカメラズームアウト */
@media screen and (orientation: landscape) {
  /* 🎯 スマホ画面全体をズームアウト（サブスロット含む全て） + 横幅拡張 */
  .mobile-device body {
    zoom: 0.7 !important; /* 画面全体を70%に縮小 */
    width: 140vw !important; /* 横幅を140%に拡張（120% + 20%） */
    overflow-x: auto !important; /* 横スクロール有効 */
  }
  
  .mobile-device .slot-wrapper:not([id$="-sub"]) {
    height: 100vh !important; /* 77vh → 100vh: スワイプエリアを130%に拡大（77×1.3≒100） */
    
    /* 🎯 横画面では画面幅の140%に拡張 */
    width: 140vw !important; /* 120vw → 140vw: 横幅を画面幅の140%に拡大 */
    min-width: 140vw !important;
    max-width: 140vw !important;
    overflow-x: auto !important; /* 横方向スクロールのみ有効 */
    overflow-y: hidden !important; /* 縦方向スクロールを無効化 */
    touch-action: pan-x manipulation !important; /* 横方向スワイプ、縦方向は画面全体移動 */
    margin: 0 !important; /* 2px → 0: マージンを削除して画面幅いっぱいに */
    padding-top: 8px !important;
  }
  
  /* 🎯 真のカメラズームアウト効果：中身のコンテンツのみを縮小 */
  .mobile-device .slot-wrapper:not([id$="-sub"]) > * {
    zoom: 1.092 !important; /* 84% → 109.2%: スワイプエリア130%拡大に合わせて中身も130%（0.84×1.3=1.092） */
  }
  .mobile-device #subslot-display-area {
    height: 10vh !important; /* 横向き時のサブスロットエリア調整 */
  }
}

/* 🎯 縦向き復帰時の設定強制再適用 - ずれ問題完全解決版 */
@media screen and (orientation: portrait) {
  .mobile-device .slot-wrapper:not([id$="-sub"]) {
    height: 38vh !important; /* 36vh → 38vh: 同比率で縮小幅を調整 */
    padding-top: 8px !important; /* 位置調整を強制再適用 */
    align-items: flex-start !important; /* 上側配置を強制再適用 */
    
    /* 🚨 追加：ずれ問題解決のための強制再配置 */
    display: flex !important; /* フレックス表示を強制再適用 */
    justify-content: flex-start !important; /* 横方向左寄せを強制再適用 */
    width: var(--mobile-width) !important; /* 横幅を強制再適用 */
    min-width: var(--mobile-width) !important; /* 最小幅を強制再適用 */
    max-width: var(--mobile-width) !important; /* 最大幅を強制再適用 */
    margin: 2px !important; /* マージンを強制再適用 */
    border: 2px solid #007bff !important; /* 境界線を強制再適用 */
    border-radius: 4px !important; /* 角丸を強制再適用 */
    background: rgba(240, 248, 255, 0.9) !important; /* 背景色を強制再適用 */
    overflow-x: auto !important; /* 横スクロールを強制再適用 */
    overflow-y: hidden !important; /* 縦スクロール無効化：見切れ防止を強制再適用 */
    touch-action: pan-x pan-y !important; /* タッチ操作を強制再適用 */
  }
  .mobile-device #subslot-display-area {
    height: 12vh !important; /* 基本設定を強制再適用 */
    width: var(--mobile-width) !important; /* 横幅を強制再適用 */
    max-width: var(--mobile-width) !important; /* 最大幅を強制再適用 */
    min-width: var(--mobile-width) !important; /* 最小幅を強制再適用 */
  }
}
