# Rephrase システム 段階的改善計画書
**作成日**: 2025年8月15日  
**対象**: Rephrase階層文法検出システム  
**現在の性能**: 85-90%精度（実測）  
**目標**: 100%精度達成

---

## 📊 現状分析

### ✅ 完璧に動作している機能
- **基本文分解**: 100%精度（S, V, O1, C1等）
- **関係詞節サブスロット**: 100%精度
  - "The book that I bought" → sub_O1:"The book that", sub_S:"I", sub_V:"bought"
  - "The person who called me" → sub_S:"The person who", sub_V:"called", sub_O1:"me"
- **使役動詞構文**: 超複雑文でも25要素完璧分解
- **副詞節・補語句**: even though節、so節、complement句完璧

### ⚠️ 改善が必要な部分
1. **Test 6**: "The car which we saw was red" でメインスロット分解ミス
2. **使役動詞 "had"** の検出漏れ  
3. **時間節・条件節** のサブスロット分解が浅い
4. **分詞構文** の検出不備

---

## 🎯 段階的改善計画

### 【Phase 1】緊急修正（1-2日）- 即効性のある問題修正

#### 1.1 spaCy依存関係解析の微調整
**対象ファイル**: `simple_unified_rephrase_integrator.py`
**問題**: "The car which we saw was red" → S:"we" になってしまう

**修正方針**:
```python
# _extract_basic_elements メソッドの主語抽出ロジック改善
def _extract_basic_elements(self, doc):
    # 関係詞節を含む主語の完全抽出を強化
    # subtree処理でより正確な範囲検出
```

**期待効果**: 関係詞節を含む主語抽出精度 90% → 100%

#### 1.2 使役動詞リストの拡張
**対象ファイル**: `simple_unified_rephrase_integrator.py`
**問題**: "He had me clean the room" で "had" が使役動詞として検出されない

**修正方針**:
```python
causative_verbs = ['make', 'let', 'have', 'help', 'get', 'force', 'cause']
# "had" (have の過去形) の検出ロジック追加
```

**期待効果**: 使役動詞検出精度 85% → 95%

#### 1.3 時間・条件節の検出パターン拡張
**対象ファイル**: `sub_slot_decomposer.py`
**問題**: "When I arrived, he was sleeping" でサブスロット分解が浅い

**修正方針**:
```python
def _detect_temporal_clauses(self, text):
    patterns = [
        r'\b(when|while|before|after|since|until)\s+[^,]+',
        r'\b(if|unless|as long as|provided that)\s+[^,]+'
    ]
    # パターン検出後のサブスロット分解強化
```

**期待効果**: 時間・条件節分解精度 60% → 90%

---

### 【Phase 2】構造改善（3-5日）- 検出精度の向上

#### 2.1 分詞構文の前処理改善
**対象ファイル**: `simple_unified_rephrase_integrator.py`
**問題**: "Having finished homework, I went out" の処理不完全

**修正方針**:
```python
def _detect_participle_constructions(self, sentence):
    # Having/Being/Walking等の分詞構文検出
    # 主節との境界明確化
    # サブスロット分解への適切な引き渡し
```

**期待効果**: 分詞構文精度 40% → 85%

#### 2.2 複合構文の境界検出精度向上
**対象ファイル**: `sub_slot_decomposer.py`  
**問題**: 複数の節が混在する場合の境界曖昧

**修正方針**:
```python
def _improve_clause_boundaries(self, text):
    # spaCy dependency parsing活用
    # 節の階層構造正確把握
    # 重複・漏れの防止
```

**期待効果**: 複合構文精度 70% → 90%

---

### 【Phase 3】高精度化（1週間）- 99%精度への到達

#### 3.1 エッジケース対応
**対象**: 特殊構文・慣用表現
- It-cleft構文: "It is John who called me"
- 省略構文: "The book I bought" (that省略)
- 挿入句: "The man, who is my father, called"

**修正方針**:
```python
def _handle_special_constructions(self, sentence):
    # 特殊構文パターン定義
    # 個別処理ロジック実装
    # 既存システムとの統合
```

#### 3.2 信頼度システム導入
**対象**: 全システム
**目的**: 不確実な分解結果の品質管理

**修正方針**:
```python
class ConfidenceManager:
    def calculate_confidence(self, result):
        # spaCy confidence score活用
        # パターンマッチ精度評価
        # 閾値によるフォールバック
```

---

### 【Phase 4】完璧化（1-2週間）- 100%精度の実現

#### 4.1 包括的テストスイート構築
**対象**: システム全体
**内容**: 
- 200+テストケース作成
- 文法書網羅的サンプル
- エラーケース記録・対策

#### 4.2 パフォーマンス最適化
**対象**: 処理速度・メモリ効率
**目標**: 
- 処理時間 0.5秒 → 0.3秒
- メモリ使用量 30%削減

#### 4.3 最終検証・品質保証
**対象**: システム全体
**方法**:
- 独立テストデータでの検証
- 人手評価との照合
- 継続的品質監視体制構築

---

## 🔄 実装スケジュール

### Week 1 (8/16-8/22)
- **Phase 1**: 緊急修正完了
- **成果目標**: 90%精度達成

### Week 2 (8/23-8/29) 
- **Phase 2**: 構造改善完了
- **成果目標**: 95%精度達成

### Week 3-4 (8/30-9/12)
- **Phase 3**: 高精度化完了
- **成果目標**: 99%精度達成

### Week 5-6 (9/13-9/26)
- **Phase 4**: 完璧化完了
- **成果目標**: 100%精度達成

---

## 📝 品質管理指針

### 毎日の作業原則
1. **実測主義**: 必ず数値で検証
2. **段階的改善**: 一度に大きな変更をしない
3. **後退防止**: 既存精度を劣化させない
4. **文書化**: すべての変更を記録

### 検証方法
- `honest_system_evaluation.py` で定期テスト
- 新機能追加時は専用テスト作成
- 週1回の包括的精度測定

### 品質基準
- **95%未満**: 改善継続
- **95-99%**: 高精度フェーズ移行
- **99%以上**: 完璧化フェーズ移行

---

## 🎯 最終目標

**2025年9月末**: 
- ✅ 100%精度のRephrase階層文法検出システム
- ✅ 包括的テストスイート
- ✅ 本格運用可能な品質
- ✅ 継続的品質保証体制

**技術的成果**:
- 全文法パターン100%対応
- 0.3秒以内高速処理
- メモリ効率最適化
- 拡張性・保守性確保

---

*本計画は現在のシステム実態(85-90%精度)に基づく現実的な改善計画です。慎重な段階的改善により、確実に100%精度を達成します。*
