# Phase 1 実行ガイド - 53例文システム完成作業
**作成日**: 2025年8月16日  
**更新日**: 2025年8月17日  
**対象**: 次期開発者・継続作業者  
**目的**: 53例文100%正解達成への具体的実行手順  

---

## 📊 **現在の状況 (2025年8月17日時点)**

### ✅ **完了済み項目**
- **53例文正解データベース完成**: 全例文の期待結果確定済み
- **5ハンドラー実装済み**: basic_five_pattern, relative_clause, passive_voice, adverbial_modifier, auxiliary_complex
- **検証システム構築済み**: final_test_system による自動管理
- **開発環境整理済み**: 43個の一時ファイル削除、クリーンな構成確立

### 🎯 **次の目標**
**53例文すべてでシステム出力 = 正解データベース** を達成

### 📋 **公式正解データとテストファイル**
- **正解データ**: `final_test_system/final_54_test_data.json` (53例文の期待値)
- **正式テスト**: `final_test_system/test_53_complete.py` (正解データ照合版)
- **現在の精度**: 39.6% (助動詞ハンドラー追加後)

---

## 🚀 **即座に実行すべき作業手順**

### **Step 1: システム性能測定**
```bash
cd training/data/final_test_system
python test_53_complete.py
```

**出力例の読み方:**
```
例文1: "I love you."
予測結果: {'S': 'I', 'V': 'love', 'O1': 'you'}
処理時間: 0.12秒
✅ 成功 / ❌ エラー
```

### **Step 2: 正解データベースとの照合**
```python
# 照合用コマンド例
from expected_results_manager import load_progress
import json

# 正解データ読み込み
progress = load_progress()
correct_answers = progress.get('results', [])

# 例文1の正解確認
example_1 = correct_answers[0]['expected_result']
print(f"正解: {example_1}")
```

### **Step 3: 不一致箇所の特定**
不一致が発生した場合：
1. **エラー原因分類**:
   - 文法ルール不備 → `rephrase_rules_v2.0.json`修正
   - ハンドラー優先度問題 → `unified_stanza_rephrase_mapper.py`調整
   - 特殊パターン未対応 → 新ルール追加

2. **修正アプローチ**:
   - 1-2例文ずつ段階的修正
   - 修正後は必ず`python custom_test.py`で再検証
   - 他例文への影響確認

---

## 📁 **重要ファイル詳細**

### **`expected_results_progress.json`** (正解データベース)
```json
{
  "1": {
    "sentence": "I love you.",
    "expected": {
      "main_slots": {"S": "I", "V": "love", "O1": "you"},
      "sub_slots": {}
    },
    "user_judgment": "correct"
  }
}
```

### **`expected_results_manager.py`** (管理ツール)
**主要機能:**
- `display_progress()`: 現在の進捗表示
- `load_progress()`: 正解データ読み込み
- `add_result()`: 新しい正解データ追加

### **`custom_test.py`** (テスト実行環境)
**設定済み内容:**
- 4ハンドラー自動ロード
- 54例文の自動実行
- エラーハンドリング付き

---

## 🔧 **学習済みパターン (重要な知見)**

### **1. サブスロット分解ルール**
```
条件・理由節: If/Although/Because + 文 
→ sub-m1, sub-s, sub-v + 空の親スロット("")

関係代名詞節: who/which/that + 文
→ sub-s/sub-o1 + sub-v + 空の親スロット("")
```

### **2. 重文への対応**
```
重文構造 (and/but接続): 現在は対象外
→ 例文46, 47はSKIP扱い
```

### **3. 特殊表現**
```
"for sale" → C1 (補語扱い)
"as if" → sub-m1 + sub-slots分解
```

---

## 📈 **成功判定基準**

### **完成の定義**
- ✅ 54例文中52例文正解 (96%以上)
- ✅ 重文2例文はSKIP許容
- ✅ エラー例文 0個
- ✅ 処理時間 各例文2秒以内

### **品質確認項目**
1. **構造正確性**: S, V, O, C の基本配置
2. **サブスロット適切性**: 条件節・関係節の正確な分解
3. **修飾語配置**: M1, M2, M3 の適切な振り分け
4. **空スロット表記**: ""による明示的表現

---

## 🛠️ **トラブルシューティング**

### **よくある問題と対策**

#### **問題1: インポートエラー**
```bash
ModuleNotFoundError: No module named 'stanza'
```
**対策**: `pip install stanza spacy`

#### **問題2: メモリ不足**
```bash
RuntimeError: CUDA out of memory
```
**対策**: `enable_gpu=False`に設定

#### **問題3: 解析結果が空**
```python
{'main_slots': {}, 'sub_slots': {}}
```
**対策**: 
1. Stanza解析結果確認
2. ハンドラーのアクティブ状態確認
3. ログレベルを'DEBUG'に変更して詳細確認

---

## 📋 **進捗管理**

### **日次確認項目**
```bash
# 毎日実行推奨
python -c "
from expected_results_manager import display_progress
display_progress()
"
```

### **週次確認項目**
1. 正解率の推移記録
2. 修正したルールの文書化
3. 新発見パターンの記録

---

## 🎯 **次期拡張準備**

### **Phase 2準備 (助動詞ハンドラー)**
完成後の拡張計画:
- `_handle_modal`: will, can, must等
- 新例文セット作成
- 正解データベース拡張

---

## 📞 **サポート情報**

### **重要な設計思想**
```
🎯 プラグイン型同時処理方式:
全ハンドラーが並行動作して、
各自の専門領域で協調処理を行う
```

### **設計仕様書**
- `UnifiedStanzaRephraseMapper_v1.0_Spec.md`: 技術詳細
- `Rephrase_システム完成工程表_2025-08-16_v1.0.md`: 全体計画

---

**🚀 最初のアクション: `python custom_test.py` を実行して現在の性能を確認！**

**最終更新**: 2025年8月16日 18:00  
**次期更新**: Phase 1完了時（54例文100%正解達成時）
