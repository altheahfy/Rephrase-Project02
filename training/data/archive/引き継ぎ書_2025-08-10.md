# 🚀 Rephrase Project 開発状況引き継ぎ書
**作成日: 2025年8月10日**

---

## 📊 **プロジェクト概要**
- **名称**: Rephrase-Project (英語文法スロット分解システム)
- **目的**: 英文をRephraseルールに従ってS-Aux-V-O1-O2-C1-C2-M1-M2-M3スロットに完全分解（複文構造のサブスロットも含む）
- **技術スタック**: Python + spaCy + JSON設定 + Excel例文DB
- **開発段階**: フェーズ3完成（90%+カバレッジ）→ 根本設計見直し段階

---

## 🎯 **現在の立ち位置**

### **✅ 達成済み**
- **基本機能完成**: SVO/SVOO/SVOC文型処理
- **関係詞節処理**: 「The boy who plays soccer」完全対応
- **冠詞問題解決**: 関係詞節内冠詞欠落修正完了
- **所有格代名詞**: 「his mother」等の正確な処理確認
- **サブスロット機能**: 関係詞節内詳細分解対応
- **エンジン規模**: 3,100行 CompleteRephraseParsingEngine

### **🚨 発見された根本問題**
- **設計思想の矛盾**: パターンマッチング型ルール vs spaCy完全連携
- **重複・欠落**: "ago"重複、"for"欠落等の系統的問題
- **ルール辞書**: v1.0が旧設計思想（具体表現ハードコード）
- **優先度処理**: ルール適用順序の不具合

---

## 🔥 **緊急対応が必要な問題**

### **1. "ago"重複問題**
```
現象: "I met him a few days ago." → M2:['ago', 'ago met'] + M3:['a few days ago']
原因: manner-degree-M2(個別抽出) vs 汎用時間表現(完全抽出)の競合
```

### **2. "for"重複問題** 
```
現象: "She worked for 2 years." → M2:['for for 2 years', 'for 2 years']
原因: for-purpose-M2パターンルールの実装バグ
```

### **3. 例文DB非準拠**
```
問題: 例文DBパターンの100%カバレッジ未達
原因: ルール辞書が構造的判定でなくパターンマッチング型
```

---

## 💡 **新設計思想（確立済み）**

### **旧アプローチ（問題あり）**
```json
"pattern": "(?i)\\b(yesterday|last night|a few days ago)\\b" → M3
```
↑ 具体表現ハードコーディング

### **新アプローチ（目指すべき方向）**
```
①spaCy: "a few days ago" → 「時間副詞句」判定
②エンジン: 「時間副詞句 + Vなし」 → 「M1-M3判定」（つまりRephraseルール適用）
③構造判断: 文全体構造から適切スロット配置
```

---

## 🛠️ **次回セッションでやるべき作業**

### **Priority 1: ルール辞書全面改写**
- `rephrase_rules_v1.0.json` → `v2.0_spacy_native.json`
- パターン型 → 構造的判定型への全面変換
- 25ルール全てを新設計思想で再実装

### **Priority 2: エンジン改修**
- CompleteRephraseParsingEngine の spaCy完全依存化
- ルール適用優先度処理の修正
- 重複除去ロジックの強化

### **Priority 3: 系統的品質保証**
- 10のエラー項目の全解決
- 例文DB全件との整合性確認
- quality_checker.py の診断精度向上

---

## 📋 **関連ファイル**

### **重要なファイル**
- `CompleteRephraseParsingEngine.py`: メインエンジン（3,100行）
- `rephrase_rules_v1.0.json`: 旧ルール辞書（要全面改写）
- `例文入力元_分解結果_v2_*.xlsx`: 例文DB（正解データ）
- `quality_checker.py`: 品質診断ツール

### **診断・テストツール**
- `rule_engine_diagnosis.py`: ルール競合診断
- `test_time_adverbs.py`: 時間副詞問題検証
- `test_possessive.py`: 所有格代名詞検証
- `simple_subslot_test.py`: サブスロット動作確認

---

## 🎯 **期待される成果**

### **短期目標（次回〜数回）**
- ago/for重複問題の完全解決
- 新ルール辞書v2.0の設計・実装
- 10のエラー項目全解決

### **中期目標**
- 例文DB 100%準拠達成
- spaCy完全連携システム完成
- 商用展開準備完了

### **技術的意義**
- パターンマッチング → 構造解析への移行
- 真のNLP連携システムの実現
- 拡張性・保守性の大幅向上

---

## 🚨 **重要な教訓**

1. **設計思想の一貫性**: パターンマッチングとNLP連携の混在は問題を生む
2. **段階的進化の限界**: 根本設計の見直しが必要な段階
3. **データ駆動の重要性**: ハードコーディング回避、JSON設定の活用

---

## 📞 **連絡事項**

- **トークン消費**: 大規模改修のため複数セッション必要
- **優先度**: 品質保証（例文DB準拠）が最重要
- **技術方針**: spaCy完全連携＋構造的判定で確定

**次回は大規模改修から開始予定** 🚀
