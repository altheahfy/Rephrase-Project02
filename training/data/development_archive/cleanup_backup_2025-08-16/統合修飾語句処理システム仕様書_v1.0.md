# 統合修飾語句処理システム仕様書 v1.0

**作成日**: 2025年8月15日  
**更新理由**: 冠詞・形容詞等の個別エンジン不要判明  
**技術方針**: 統一処理システムによる効率化

## 🎯 **設計方針転換**

### **❌ 旧方針（廃止）**
```yaml
個別エンジン開発計画:
  ❌ 冠詞・定冠詞エンジン
  ❌ 形容詞エンジン  
  ❌ 所有格エンジン
  ❌ 数詞エンジン
  ❌ 複合名詞エンジン

問題点:
  - 開発工数の無駄な増大
  - メンテナンス対象の複雑化
  - エンジン間競合リスクの増加
```

### **✅ 新方針（採用）**
```yaml
統合修飾語句処理システム:
  ✅ _build_phrase_with_modifiers() 単一関数
  ✅ 全修飾語タイプの統一処理
  ✅ シンプルな実装・保守

技術的メリット:
  - 開発工数: 1/5に削減
  - バグ修正効率: 一箇所での修正で全対応
  - 新修飾語タイプ追加: 数行の修正で対応
```

## 📊 **技術仕様**

### **対応修飾語タイプ**
```python
def _build_phrase_with_modifiers(self, sentence, main_word):
    # 対応修飾語：5カテゴリ完全網羅
    supported_modifiers = [
        'det',        # 冠詞・限定詞: a, an, the, my, your, this, that
        'amod',       # 形容詞: red, beautiful, smart, old, new
        'nummod',     # 数詞: one, two, first, second, many, few  
        'nmod:poss',  # 所有格: John's, Mary's, his, her, its
        'compound'    # 複合名詞: car door, school bus, high school
    ]
```

### **統合処理フロー**
```yaml
1. 修飾語収集:
   - sentence.words全体をスキャン
   - main_word.idをHEADとする語を検出
   - supported_modifiersに該当する語のみ抽出

2. 語順整理:
   - word.idによるソート（自然語順保持）
   - 修飾語 + メイン語の順序で配置

3. 句構築:
   - ' '.join()で自然な文字列化
   - デバッグログ出力で動作確認可能
```

## 🚀 **実装状況**

### **✅ 完了項目**
- [x] `_build_phrase_with_modifiers()` 関数実装
- [x] 5カテゴリ修飾語対応
- [x] デバッグログ機能
- [x] 基本5文型エンジンとの統合

### **🔄 修正必要項目**
- [ ] **全スロットでの修飾語句処理適用**
  - 現状: S（主語）のみで動作
  - 必要: O1, O2, C1, C2, M1, M2, M3でも適用

### **📋 修正対象**
```python
# 現在の問題箇所
def _generate_basic_five_slots(self, pattern, mapping, dep_relations, sentence):
    for dep_rel, slot in mapping.items():
        if dep_rel in dep_relations:
            words = dep_relations[dep_rel]
            if words:
                main_word = words[0]
                phrase = self._build_phrase_with_modifiers(sentence, main_word)
                slots[slot] = phrase  # ← この処理がC1で実行されていない
```

## 🎯 **期待効果**

### **開発効率向上**
- **工数削減**: 個別エンジン × 5 → 統合関数 × 1
- **コード品質**: 単一責任・統一実装
- **テスト効率**: 一箇所のテストで全修飾語対応

### **ユーザー価値向上**  
- **精度向上**: "my neighbor" → "neighbor"の問題解決
- **一貫性**: 全スロットで統一された修飾語処理
- **拡張性**: 新しい修飾語タイプの容易な追加

## 📈 **今後の展開**

### **Phase 1: 基本修正（即座実行）**
1. C1スロットでの修飾語処理適用
2. "my neighbor"問題の解決確認
3. 全スロット対応の動作確認

### **Phase 2: 拡張対応（必要時）**
1. 追加修飾語タイプ検討
2. 複雑な修飾構造への対応
3. パフォーマンス最適化

### **Phase 3: 運用安定化**
1. エラーハンドリング強化
2. ログ機能の改善
3. 商用環境での安定稼働確認

---

**結論**: 個別エンジン開発は完全に不要。統合修飾語句処理システムで全要求を効率的に実現可能。
