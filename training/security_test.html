<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”’ Rephrase ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 3px; cursor: pointer; }
        .test-btn { background: #007bff; color: white; }
        .danger-btn { background: #dc3545; color: white; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
        #results { margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ”’ Rephrase ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>1. åŸºæœ¬ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å‹•ä½œç¢ºèª</h2>
        <button class="test-btn" onclick="testBasicSecurity()">åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
        <div id="basic-results"></div>
    </div>

    <div class="test-section">
        <h2>2. å…¥åŠ›å€¤ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
        <textarea id="test-input" placeholder="ãƒ†ã‚¹ãƒˆç”¨ã®å…¥åŠ›å€¤ã‚’å…¥ã‚Œã¦ãã ã•ã„ï¼ˆä¾‹: <script>alert('XSS')</script>ï¼‰"></textarea>
        <button class="test-btn" onclick="testSanitization()">ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</button>
        <div id="sanitization-results"></div>
    </div>

    <div class="test-section">
        <h2>3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</h2>
        <input type="file" id="test-file" multiple>
        <button class="test-btn" onclick="testFileValidation()">ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</button>
        <div id="file-results"></div>
    </div>

    <div class="test-section">
        <h2>4. ã‚»ã‚­ãƒ¥ã‚¢ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ</h2>
        <input type="text" id="storage-key" placeholder="ã‚­ãƒ¼" value="test_key">
        <input type="text" id="storage-value" placeholder="å€¤" value="ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿123">
        <button class="test-btn" onclick="testSecureStorage()">æš—å·åŒ–ä¿å­˜ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-btn" onclick="testStorageRetrieval()">æš—å·åŒ–èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</button>
        <div id="storage-results"></div>
    </div>

    <div class="test-section">
        <h2>5. æ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆï¼ˆå®‰å…¨ãªç’°å¢ƒã§ã®ç¢ºèªï¼‰</h2>
        <button class="danger-btn" onclick="testXSSPatterns()">XSSæ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ</button>
        <button class="danger-btn" onclick="testScriptInjection()">ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</button>
        <div id="attack-results"></div>
    </div>

    <div id="results"></div>

    <script type="module">
        import { 
            escapeHtml, 
            safeJsonParse, 
            validateFileUpload, 
            secureLocalStorageSet, 
            secureLocalStorageGet,
            detectScriptInjection,
            validateURL
        } from './js/security.js';

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹ã—ã¦ãƒ†ã‚¹ãƒˆé–¢æ•°ã‹ã‚‰ä½¿ç”¨å¯èƒ½ã«ã™ã‚‹
        window.securityUtils = {
            escapeHtml,
            safeJsonParse,
            validateFileUpload,
            secureLocalStorageSet,
            secureLocalStorageGet,
            detectScriptInjection,
            validateURL
        };

        window.testBasicSecurity = function() {
            const results = document.getElementById('basic-results');
            let html = '<h3>åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆçµæœ:</h3>';
            
            try {
                // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å­˜åœ¨ç¢ºèª
                if (window.securityUtils) {
                    html += '<p class="pass">âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ</p>';
                } else {
                    html += '<p class="fail">âŒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—</p>';
                }

                // CSPãƒ˜ãƒƒãƒ€ãƒ¼ã®ç¢ºèª
                const cspMeta = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
                if (cspMeta) {
                    html += '<p class="pass">âœ… Content Security Policyè¨­å®šæ¸ˆã¿</p>';
                } else {
                    html += '<p class="warning">âš ï¸ Content Security Policyæœªè¨­å®š</p>';
                }

                // XFO ãƒ˜ãƒƒãƒ€ãƒ¼ã®ç¢ºèª
                const xfoMeta = document.querySelector('meta[http-equiv="X-Frame-Options"]');
                if (xfoMeta) {
                    html += '<p class="pass">âœ… X-Frame-Optionsè¨­å®šæ¸ˆã¿</p>';
                } else {
                    html += '<p class="warning">âš ï¸ X-Frame-Optionsæœªè¨­å®š</p>';
                }

                // HTTPS ãƒã‚§ãƒƒã‚¯
                if (location.protocol === 'https:') {
                    html += '<p class="pass">âœ… HTTPSé€šä¿¡</p>';
                } else {
                    html += '<p class="warning">âš ï¸ HTTPé€šä¿¡ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯HTTPSæ¨å¥¨ï¼‰</p>';
                }

            } catch (error) {
                html += `<p class="fail">âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
            
            results.innerHTML = html;
        };

        window.testSanitization = function() {
            const input = document.getElementById('test-input').value;
            const results = document.getElementById('sanitization-results');
            let html = '<h3>ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆçµæœ:</h3>';
            
            try {
                const sanitized = window.securityUtils.escapeHtml(input);
                html += `<p><strong>å…ƒã®å…¥åŠ›:</strong> ${input}</p>`;
                html += `<p><strong>ã‚µãƒ‹ã‚¿ã‚¤ã‚ºå¾Œ:</strong> ${sanitized}</p>`;
                
                if (input !== sanitized) {
                    html += '<p class="pass">âœ… ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æ­£å¸¸å‹•ä½œ</p>';
                } else {
                    html += '<p class="warning">âš ï¸ å¤‰æ›´ãªã—ï¼ˆå®‰å…¨ãªå…¥åŠ›ã®å¯èƒ½æ€§ï¼‰</p>';
                }

                // ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºãƒ†ã‚¹ãƒˆ
                const isScript = window.securityUtils.detectScriptInjection(input);
                if (isScript) {
                    html += '<p class="warning">âš ï¸ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º</p>';
                } else {
                    html += '<p class="pass">âœ… å®‰å…¨ãªå…¥åŠ›ã¨ã—ã¦åˆ¤å®š</p>';
                }

            } catch (error) {
                html += `<p class="fail">âŒ ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
            
            results.innerHTML = html;
        };

        window.testFileValidation = function() {
            const fileInput = document.getElementById('test-file');
            const results = document.getElementById('file-results');
            let html = '<h3>ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼ãƒ†ã‚¹ãƒˆçµæœ:</h3>';
            
            if (fileInput.files.length === 0) {
                html += '<p class="warning">âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</p>';
            } else {
                for (let i = 0; i < fileInput.files.length; i++) {
                    const file = fileInput.files[i];
                    const validation = window.securityUtils.validateFileUpload(file);
                    
                    html += `<div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd;">`;
                    html += `<p><strong>ãƒ•ã‚¡ã‚¤ãƒ« ${i + 1}:</strong> ${file.name}</p>`;
                    html += `<p><strong>ã‚µã‚¤ã‚º:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>`;
                    html += `<p><strong>ã‚¿ã‚¤ãƒ—:</strong> ${file.type}</p>`;
                    
                    if (validation.valid) {
                        html += '<p class="pass">âœ… æ¤œè¨¼æˆåŠŸ</p>';
                    } else {
                        html += '<p class="fail">âŒ æ¤œè¨¼å¤±æ•—</p>';
                        html += `<p class="fail">ã‚¨ãƒ©ãƒ¼: ${validation.errors.join(', ')}</p>`;
                    }
                    html += '</div>';
                }
            }
            
            results.innerHTML = html;
        };

        window.testSecureStorage = function() {
            const key = document.getElementById('storage-key').value;
            const value = document.getElementById('storage-value').value;
            const results = document.getElementById('storage-results');
            
            try {
                window.securityUtils.secureLocalStorageSet(key, value);
                results.innerHTML = '<p class="pass">âœ… ã‚»ã‚­ãƒ¥ã‚¢ä¿å­˜æˆåŠŸ</p>';
            } catch (error) {
                results.innerHTML = `<p class="fail">âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        };

        window.testStorageRetrieval = function() {
            const key = document.getElementById('storage-key').value;
            const results = document.getElementById('storage-results');
            
            try {
                const retrieved = window.securityUtils.secureLocalStorageGet(key);
                if (retrieved !== null) {
                    results.innerHTML += `<p class="pass">âœ… ã‚»ã‚­ãƒ¥ã‚¢èª­ã¿è¾¼ã¿æˆåŠŸ: ${retrieved}</p>`;
                } else {
                    results.innerHTML += '<p class="warning">âš ï¸ ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>';
                }
            } catch (error) {
                results.innerHTML += `<p class="fail">âŒ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        };

        window.testXSSPatterns = function() {
            const results = document.getElementById('attack-results');
            let html = '<h3>XSSæ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆçµæœ:</h3>';
            
            const xssPatterns = [
                '<script>alert("XSS")</script>',
                'javascript:alert("XSS")',
                '<img src="x" onerror="alert(\'XSS\')">',
                '<div onmouseover="alert(\'XSS\')">hover me</div>',
                '"><script>alert("XSS")</script>',
                "';alert('XSS');//"
            ];
            
            xssPatterns.forEach((pattern, index) => {
                const sanitized = window.securityUtils.escapeHtml(pattern);
                const detected = window.securityUtils.detectScriptInjection(pattern);
                
                html += `<div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd;">`;
                html += `<p><strong>ãƒ‘ã‚¿ãƒ¼ãƒ³ ${index + 1}:</strong> ${pattern}</p>`;
                html += `<p><strong>ã‚µãƒ‹ã‚¿ã‚¤ã‚ºå¾Œ:</strong> ${sanitized}</p>`;
                html += detected ? 
                    '<p class="pass">âœ… æ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦æ­£ã—ãæ¤œå‡º</p>' : 
                    '<p class="fail">âŒ æ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæœªæ¤œå‡º</p>';
                html += '</div>';
            });
            
            results.innerHTML = html;
        };

        window.testScriptInjection = function() {
            const results = document.getElementById('attack-results');
            results.innerHTML += '<h3>ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ:</h3>';
            
            const testJson = '{"name": "test<script>alert(123)</script>", "value": "test"}';
            const parsed = window.securityUtils.safeJsonParse(testJson);
            
            if (parsed && parsed.name && !parsed.name.includes('<script>')) {
                results.innerHTML += '<p class="pass">âœ… JSONãƒ‘ãƒ¼ã‚¹æ™‚ã®XSSãŒæ­£ã—ãé˜²å¾¡ã•ã‚Œã¾ã—ãŸ</p>';
            } else {
                results.innerHTML += '<p class="fail">âŒ JSONãƒ‘ãƒ¼ã‚¹æ™‚ã®XSSé˜²å¾¡ã«å•é¡ŒãŒã‚ã‚Šã¾ã™</p>';
            }
        };

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åŸºæœ¬ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                window.testBasicSecurity();
            }, 1000);
        });
    </script>
</body>
</html>
